<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Impostor Fútbol</title>
<!-- Incluye las fuentes y íconos necesarios -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Bebas+Neue&family=Inter:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
<!-- Se eliminó el script de Tone.js y toda la lógica de sonido -->

<style>
:root {
--color-primary: #004d98; /* Azul profundo como la camiseta */
--color-secondary: #00bfff; /* Celeste */
--color-accent: #fcd116; /* Dorado */
--color-text-dark: #222;
--color-text-light: #fff;
--color-bg: #e0f7fa;
--font-main: 'Bebas Neue', 'Inter', sans-serif;
--font-secondary: 'Inter', 'Roboto', sans-serif;
}

body {
font-family: var(--font-secondary);
background: linear-gradient(135deg, var(--color-bg), #b3e5fc);
color: var(--color-text-dark);
display: flex;
justify-content: center;
align-items: center;
min-height: 100vh;
margin: 0;
padding: 20px;
box-sizing: border-box;
background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" opacity="0.1"><path d="M50 0 L100 25 L100 75 L50 100 L0 75 L0 25 Z" fill="%23004d98"/><circle cx="50" cy="50" r="40" fill="%23fcd116" stroke="%2300bfff" stroke-width="5" fill-opacity="0.2"/></svg>');
background-size: 50px;
background-repeat: repeat;
-webkit-font-smoothing: antialiased;
-moz-osx-font-smoothing: grayscale;
transition: background 0.5s;
}

/* NUEVO: Estilo para la alarma del impostor */
body.impostor-alarm {
background: #800 !important; /* Rojo oscuro */
}

.container {
background: rgba(255, 255, 255, 0.95);
padding: 30px;
border-radius: 20px;
box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
text-align: center;
max-width: 500px;
width: 100%;
border: 5px solid var(--color-primary);
position: relative;
overflow: hidden;
transition: transform 0.3s ease-out;
}

h1 {
font-family: var(--font-main);
font-size: clamp(2rem, 8vw, 4rem);
color: var(--color-primary);
text-shadow: 3px 3px 0 var(--color-secondary), 6px 6px 0 var(--color-accent);
letter-spacing: 2px;
margin-bottom: 20px;
text-transform: uppercase;
}

h2 {
font-family: var(--font-main);
font-size: clamp(1.5rem, 6vw, 3rem);
color: var(--color-text-dark);
margin-bottom: 20px;
}

.screen {
display: none;
flex-direction: column;
align-items: center;
justify-content: flex-start;
gap: 20px;
padding: 10px;
border: 2px solid var(--color-primary);
border-radius: 15px;
background: #fff;
box-shadow: inset 0 0 15px rgba(0,0,0,0.1);
transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
opacity: 0;
transform: translateY(20px);
max-height: 80vh;
overflow-y: auto;
}

.screen.active {
display: flex;
opacity: 1;
transform: translateY(0);
}

.btn {
font-family: var(--font-main);
font-size: clamp(1.2rem, 5vw, 2rem);
padding: 15px 30px;
border: none;
border-radius: 10px;
cursor: pointer;
text-transform: uppercase;
letter-spacing: 1px;
transition: transform 0.2s, box-shadow 0.2s, background-color 0.2s;
box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
width: 100%;
max-width: 300px;
color: var(--color-text-light);
background: var(--color-primary);
background-image: linear-gradient(to right, var(--color-primary) 0%, #0060c0 100%);
border: 2px solid var(--color-text-light);
}

.btn:hover {
transform: translateY(-3px);
box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
background-image: linear-gradient(to right, #0060c0 0%, var(--color-primary) 100%);
}

.btn.secondary {
background: var(--color-secondary);
background-image: linear-gradient(to right, var(--color-secondary) 0%, #33c8ff 100%);
margin-top: 10px;
border: 2px solid var(--color-primary);
}
.small-btn {
font-size: 1rem;
max-width: 250px;
padding: 10px 20px;
margin: 15px auto 0 auto;
}

.option-group {
width: 100%;
padding: 15px 0;
border-bottom: 1px dashed #ccc;
}

.count-controls {
display: flex;
align-items: center;
justify-content: center;
gap: 15px;
margin-bottom: 10px;
}

.option-label {
font-family: var(--font-secondary);
font-size: 1.2rem;
font-weight: 700;
color: var(--color-text-dark);
/* width: 150px; */ /* Ajustado para checkboxes */
}

.option-value {
font-family: var(--font-main);
font-size: 2.5rem;
color: var(--color-primary);
}

.arrow-btn {
background: transparent;
border: none;
cursor: pointer;
color: var(--color-primary);
font-size: 2rem;
transition: transform 0.2s, color 0.2s;
}

.arrow-btn:hover {
transform: scale(1.2);
color: var(--color-accent);
}

/* Estilos para nombres de jugadores */
#player-names-container {
width: 100%;
display: flex;
flex-direction: column;
gap: 10px;
margin-top: 10px;
/* Se oculta por defecto */
}

.player-name-input {
width: 100%;
padding: 10px;
border: 2px solid var(--color-secondary);
border-radius: 8px;
font-size: 1rem;
text-align: center;
transition: border-color 0.2s;
}

.player-name-input:focus {
outline: none;
border-color: var(--color-primary);
}
/* Estilos para el selector de categoría */
#category-selector {
width: 100%;
padding: 10px;
border: 2px solid var(--color-primary);
border-radius: 8px;
font-size: 1.1rem;
background-color: #f8f8f8;
font-family: var(--font-secondary);
cursor: pointer;
}

/* NUEVO: Estilos para grupo de checkboxes */
.checkbox-group {
display: flex;
flex-direction: column;
align-items: flex-start;
gap: 15px;
padding: 10px 20px;
text-align: left;
width: 100%;
box-sizing: border-box;
}
.checkbox-group div {
display: flex;
align-items: center;
gap: 10px;
}
.checkbox-group label {
font-family: var(--font-secondary);
font-size: 1.1rem;
font-weight: 500;
color: var(--color-text-dark);
}
.checkbox-group input[type="checkbox"] {
width: 20px;
height: 20px;
cursor: pointer;
}


/* Pantalla de juego */
.game-display {
background-color: #f0f0f0;
border: 4px solid var(--color-primary);
border-radius: 15px;
padding: 40px 20px;
min-height: 200px;
display: flex;
flex-direction: column;
justify-content: center;
align-items: center;
width: 100%;
box-sizing: border-box;
box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.1);
}
#player-name-display {
font-family: var(--font-main);
font-size: clamp(2rem, 8vw, 4rem);
color: var(--color-primary);
animation: fadeIn 0.5s ease-out;
/* Se muestra solo el nombre */
}

#word-display {
font-family: var(--font-main);
font-size: clamp(1.8rem, 7vw, 3.5rem);
color: var(--color-text-dark);
text-shadow: 1px 1px 0 rgba(0,0,0,0.1);
text-transform: uppercase;
text-align: center;
animation: zoomIn 0.3s ease-out;
}

@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
@keyframes zoomIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }

.hidden { display: none; }

.impostor-text {
color: var(--color-accent);
animation: pulse 1.5s infinite;
}

@keyframes pulse {
0% { transform: scale(1); }
50% { transform: scale(1.05); }
100% { transform: scale(1); }
}
/* Modal */
.modal {
display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%;
overflow: auto; background-color: rgba(0,0,0,0.5); justify-content: center; align-items: center;
}
.modal-content {
background-color: #fefefe; padding: 20px; border-radius: 10px; text-align: center;
max-width: 400px; position: relative; box-shadow: 0 4px 10px rgba(0,0,0,0.2); animation: slideIn 0.3s ease-out;
}
@keyframes slideIn { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

/* Estilos de la pantalla final */
#impostor-reveal-btn {
margin-top: 15px;
background-color: #d9534f;
background-image: linear-gradient(to right, #d9534f 0%, #c9302c 100%);
}

#impostor-list {
list-style: none;
padding: 0;
font-family: var(--font-secondary);
font-size: 1.4rem;
font-weight: bold;
color: #c9302c; /* Rojo para los impostores */
margin-top: 10px;
}
#end-message-final {
font-size: 1.2rem;
color: var(--color-text-dark);
}
/* NUEVO: Info de ronda especial */
#special-round-info {
font-size: 1.3rem;
font-weight: bold;
color: var(--color-primary);
margin-top: 10px;
}
</style>
</head>
<body>

<div class="container">
<!-- Pantalla de inicio -->
<div id="start-screen" class="screen active">
<h1>Impostor Fútbol</h1>
<p>Descubre el impostor entre tus amigos. ¡Que comience el partido!</p>
<button id="start-game-btn" class="btn">Iniciar Partida</button>
</div>

<!-- Pantalla de configuración -->
<div id="config-screen" class="screen">
<h2>Configuración</h2>
<!-- Cantidad de jugadores -->
<div class="option-group">
<div class="count-controls">
<button class="arrow-btn" id="players-minus" aria-label="Disminuir jugadores"><i class="fas fa-arrow-left"></i></button>
<div>
<div class="option-label">Jugadores</div>
<div class="option-value" id="player-count-display">3</div>
</div>
<button class="arrow-btn" id="players-plus" aria-label="Aumentar jugadores"><i class="fas fa-arrow-right"></i></button>
</div>
<!-- Botón para alternar la visión de los inputs de nombre -->
<button id="toggle-names-btn" class="btn secondary small-btn">Cambiar nombres de jugadores</button>

<!-- Inputs de nombre de jugadores se inyectan aquí. Ocultos por defecto. -->
<div id="player-names-container" class="hidden">
</div>
</div>
<!-- Cantidad de impostores -->
<div class="option-group">
<div class="count-controls">
<button class="arrow-btn" id="impostors-minus" aria-label="Disminuir impostores"><i class="fas fa-arrow-left"></i></button>
<div>
<div class="option-label">Impostores</div>
<div class="option-value" id="impostor-count-display">1</div>
</div>
<button class="arrow-btn" id="impostors-plus" aria-label="Aumentar impostores"><i class="fas fa-arrow-right"></i></button>
</div>
</div>

<!-- Selector de categoría -->
<div class="option-group">
<div class="option-label">Tema de la Palabra</div>
<select id="category-selector">
<option value="players">Jugadores de Fútbol</option>
<option value="clubs">Clubes de Fútbol</option>
<option value="clashroyale">Cartas de Clash Royale</option>
<option value="f1Pilots">Pilotos de F1</option>
<option value="alumnos3ro">Alumnos 3ro</option>
<option value="genteColegio">Gente del Colegio</option>
<option value="profes">Profesores</option>
<option value="cosasCotidianas">Cosas Cotidianas</option>
<option value="random">Al Azar</option>
</select>
</div>

<!-- NUEVO: Opciones de Juego -->
<div class="option-group checkbox-group">
<div>
<input type="checkbox" id="special-rounds-check">
<label for="special-rounds-check">Habilitar Rondas Especiales</label>
</div>
<div>
<input type="checkbox" id="impostor-knows-check" checked>
<label for="impostor-knows-check">El impostor sabe que es impostor</label>
</div>
</div>
<!-- FIN DE NUEVAS OPCIONES -->

<button id="start-round-btn" class="btn">Iniciar Partida</button>
</div>

<!-- Pantalla de juego (mostrar palabra) -->
<div id="word-screen" class="screen">
<h2 id="player-name-display">Es el turno de...</h2>
<div class="game-display">
<button id="show-word-btn" class="btn">Mostrar Palabra</button>
<p id="word-display" class="hidden"></p>
</div>
<button id="next-player-btn" class="btn secondary">Siguiente Jugador</button>
</div>
<!-- Pantalla final -->
<div id="end-screen" class="screen">
<h2>¡Final de la Ronda!</h2>
<p id="end-message-initial">Ahora es momento de discutir y votar. ¿Quién te pareció el más sospechoso?</p>
<button id="impostor-reveal-btn" class="btn">Revelar Impostores</button>
<div id="reveal-area" class="hidden">
<p id="special-round-info" class="hidden"></p> <!-- NUEVO: Para info de ronda especial -->
<p id="end-message-final">Los impostores eran:</p>
<ul id="impostor-list"></ul>
</div>

<button id="play-again-btn" class="btn">Jugar de Nuevo</button>
<button id="change-settings-btn" class="btn secondary">Cambiar Ajustes</button>
</div>

</div>
<!-- Modal para mensajes de error o información -->
<div id="message-modal" class="modal">
<div class="modal-content">
<p id="modal-text"></p>
<button id="modal-close-btn" class="btn">Entendido</button>
</div>
</div>

<!-- NUEVO: Audio de alarma (debe estar fuera del container) -->
<!-- CAMBIA EL SRC por tu enlace de audio -->
<audio id="alarm-sound" src="placeholder_alarm.mp3" loop preload="auto"></audio>


<script>
// --- BASE DE DATOS DE PALABRAS ---
const playersList = [
"Lionel Messi", "Cristiano Ronaldo", "Diego Maradona", "Pelé", "Zinedine Zidane",
"Ronaldo Nazário", "Johan Cruyff", "Franz Beckenbauer", "Garrincha", "Denzel Dumfries",
"Alfredo Di Stéfano", "Ferenc Puskás", "Zlatan Ibrahimovic", "Marco van Basten", "Zlatan Ibrahimović",
"Andrés Iniesta", "Xavi Hernández", "Ronaldinho Gaúcho", "Neymar Jr.", "Kylian Mbappé",
"Erling Haaland", "Luka Modrić", "Kevin De Bruyne", "Mohamed Salah", "Robert Lewandowski",
"Sergio Ramos", "Virgil van Dijk", "Manuel Neuer", "Alisson Becker", "Marc-André ter Stegen",
"Paulo Dybala", "Ángel Di María", "Lautaro Martínez", "Julián Álvarez", "Frank Fabra",
"N'Golo Kanté", "Sadio Mané", "Harry Kane", "Son Heung-min", "Thierry Henry",
"Didier Drogba", "Samuel Eto'o", "Arjen Robben", "Franck Ribéry", "Carles Puyol",
"Gerard Piqué", "Andrea Pirlo", "Gianluigi Buffon", "Iker Casillas", "David Beckham",
"Kaká", "Wayne Rooney", "Frank Lampard", "Steven Gerrard", "Paolo Maldini",
"Roberto Baggio", "Gabriel Batistuta", "Federico Chiesa", "Romario", "Bebeto",
"Javier Zanetti", "Gonzalo Montiel", "Juan Román Riquelme", "Carlos Tévez", "Sergio Agüero",
"Diego Simeone", "Alan Velasco", "Mascherano", "Javier Saviola", "Pablo Aimar",
"Radamel Falcao", "James Rodríguez", "Luis Suárez", "Edinson Cavani", "Arturo Vidal",
"Alexis Sánchez", "Claudio Bravo", "Keylor Navas", "Christian Pulisic",
"Rodrigo De Paul", "Chicharito Hernández",
"Guillermo Ochoa", "Francesco Totti", "Alessandro Del Piero", "Giorgio Chiellini",
"Leonardo Bonucci", "Nahuel Molina", "Mario Balotelli", "Paul Pogba", "Antoine Griezmann",
"Karim Benzema", "Vinícius Jr.", "Rodrygo", "Federico Valverde", "Casemiro",
"Toni Kroos", "Thomas Müller", "Joshua Kimmich", "Manuel Neuer", "Mesut Özil",
"Marco Reus", "Leroy Sané", "Kai Havertz", "Timo Werner", "Mats Hummels",
"Jude Bellingham", "Phil Foden", "Jack Grealish", "Marcus Rashford", "Bukayo Saka",
"Mason Mount", "Declan Rice", "Trent Alexander-Arnold", "Kyle Walker", "Raheem Sterling",
"Hakim Ziyech", "Achraf Hakimi", "Riyad Mahrez", "André Onana",
"Christian Eriksen", "Pierre-Emerick Aubameyang",
"Heung-Min Son", "Miguel Merentiel",
"Ivan Rakitić", "Josko Gvardiol", "Gareth Bale",
"Frank Fabra", "Raúl Asencio", "Hugo Lloris", "Richarlison",
"Bruno Fernandes", "Bernardo Silva", "João Félix", "Rúben Dias", "Raphael Varane",
"Raphael Guerreiro", "João Cancelo", "Gonçalo Ramos", "Vitinha", "Darwin Núñez",
"Luis Díaz", "Luis Muriel", "Juan Guillermo Cuadrado", "David Ospina", "David Neres",
"Antony", "Fred", "Gabriel Martinelli", "Gabriel Jesus", "Vini Jr",
"Sergio Busquets", "Jordi Alba", "Ferran Torres", "Gavi", "Pedri",
"Emiliano Martínez", "Alejandro Garnacho", "Nico Otamendi"
];
const clubsList = [
"Real Madrid", "FC Barcelona", "Manchester United", "Liverpool FC", "Bayern Múnich",
"Juventus FC", "AC Milán", "Inter de Milán", "París Saint-Germain", "Manchester City",
"Chelsea FC", "Arsenal FC", "Atlético de Madrid", "Borussia Dortmund", "Ajax Ámsterdam",
"River Plate", "Boca Juniors", "Independiente", "Racing Club", "San Lorenzo",
"São Paulo FC", "CR Flamengo", "SE Palmeiras", "Club América", "Chivas Guadalajara",
"Inter Miami", "New York City FC", "Benfica", "FC Porto", "Sporting CP",
"Olympique de Lyon", "Olympique de Marsella", "AS Mónaco", "Galatasaray SK", "Fenerbahçe SK",
"Besiktas JK", "Celtic FC", "Rangers FC", "Napoli", "AS Roma",
"Valencia CF", "Sevilla FC", "Real Betis", "Tottenham Hotspur", "Leicester City",
"West Ham United", "Everton FC", "Bayer Leverkusen", "RB Leipzig", "Schalke 04"
];

// --- NUEVA CATEGORÍA: CARTAS DE CLASH ROYALE ---
const clashRoyaleList = [
"Gigante Eléctrico", "Montapuercos", "P.E.K.K.A", "Mago Eléctrico", "Mini P.E.K.K.A",
"Príncipe", "Princesa", "Caballero", "Valquiria", "Bruja",
"Bebé Dragón", "Esqueleto Gigante", "Golem", "Sabueso de Lava", "Dragón Infernal",
"Cementerio", "Tronco", "Bola de Fuego", "Rayo", "Cohete",
"Descarga", "Flechas", "Veneno", "Tornado", "Emperatriz Espiritual",
"Pandilla de Duendes", "Esqueletos", "Murciélagos", "Espíritu de Hielo", "Espíritu de Fuego",
"Arqueras", "Mosquetera", "Duendes con Lanza", "Duendes", "Mega Esbirro",
"Trío de Mosqueteras", "Bárbaros de Élite", "Mago de Hielo", "Leñador", "Bandida",
"Furia", "Clon", "Espejo", "Recolector de Elixir", "Torre Infierno",
"Ballesta", "Mortero", "Horno", "Jaula del Forzudo", "Ariete de Batalla",
"Barril de Duendes", "Barril de Esqueletos", "Globo", "Minero", "Puerco Gigante",
"Curandera Guerrera", "Torre Tesla", "Choza de Bárbaros", "Torre Bombardera", "Rey Esqueleto"
];
// 4. FÓRMULA 1 - PILOTOS (NUEVA CATEGORÍA)
const f1PilotsList = [
"Max Verstappen", "Lewis Hamilton", "Charles Leclerc", "Lando Norris", "Fernando Alonso",
"Sergio Pérez", "George Russell", "Carlos Sainz", "Oscar Piastri", "Daniel Ricciardo",
"Sebastian Vettel", "Michael Schumacher", "Ayrton Senna", "Alain Prost", "Niki Lauda",
"Franco Colapinto", "Juan Manuel Fangio", "Kimi Räikkönen", "Jenson Button", "Nico Rosberg",
"Valtteri Bottas", "Esteban Ocon", "Pierre Gasly", "Yuki Tsunoda", "Lance Stroll",
"Alexander Albon", "Kevin Magnussen", "Nico Hülkenberg", "Zhou Guanyu", "Logan Sargeant", "Jack Doohan"
];

// --- INICIO DE NUEVAS CATEGORÍAS ---

// 5. ALUMNOS 3RO
const alumnos3roList = [
"Bauti", "Beltina", "Bernardita", "Guada Molina", "Simon Carranza", "Emma Llugdar", 
"Emma Carabajal", "Fabri", "Felipon", "Fran", "Gae", "Guada Elias", "Jana", "Jazmin", 
"Jere", "Juana", "Lara", "Lola", "Lolo", "Lucia", "Masao", "Mateo", "Matias", 
"Santi Hiller", "Nika", "Julia", "Olivia", "Pedro", "Santino", "Simon Abbadie", 
"Sofia", "Thiago Michiels", "Valentina", "Victoria"
];

// 6. GENTE DEL COLEGIO
const genteColegioList = [
"Bauti", "Beltina", "Bernardita", "Guada Molina", "Simon Carranza", "Emma Llugdar", 
"Emma Carabajal", "Fabri", "Felipon", "Fran", "Gae", "Guada Elias", "Jana", "Jazmin", 
"Jere", "Juana", "Lara", "Lola", "Lolo", "Lucia", "Masao", "Mateo", "Matias", 
"Santi Hiller", "Nika", "Julia", "Olivia", "Pedro", "Santino", "Simon Abbadie", 
"Sofia", "Thiago Michiels", "Valentina", "Victoria", "La suplente de PDL", 
"Diana Justel (Profe de Ingles)", "Mara Camba (Profe de Ingles)", "Cintia Milano (Profe de Plastica)", 
"Vicky Lasarte (Profe de Matematica)", "Julieta Levis (Profe de Matematica)", 
"Debora Alvarez (Profe de Matematica)", "Cyntia de La Vega (Profe de Matematica)", 
"Francisco Santillan (Profe de Historia)", "Angie Diz (Profe de PDL)", 
"Mariana Fernandez (Profe de Biologia)", "Estefania Maffei (Profe de Biologia)", 
"Marcelo (Profe de Primaria Turno Mañana)", "Eugenia Huinchulef (Profe de Construccion de Ciudadania)", 
"Cintia Olsen (Profe de Taller)", "Carmen (Profe de Teatro y Ciudadania)", 
"Rocio Maldini (Profe de Fisico-Quimica)", "Quesadilla", "Gero (Hermano de Ramiro Ali)", 
"Jano (1ro)", "Uma (Hermana de Jana)", "Tizi (Hermana de Lolo)", "Ramiro", "Felipe Sanchez", 
"Joaco Lopez", "Thiago Barcala", "Simon Contartese", "Juanse", "Ezequiel", "Luisiana", 
"Milo", "Manuel Saucedo", "Julia Franchini", "Alma (Bolivar)", "Lucas (Preceptor)", 
"Giuli (Preceptora)", "Noe (Preceptora)", "Isis (Preceptora)", "Agucho (Recepción)"
];

// 7. PROFESORES
const profesList = [
"La suplente de PDL", "Diana Justel (Profe de Ingles)", "Mara Camba (Profe de Ingles)", 
"Cintia Milano (Profe de Plastica)", "Vicky Lasarte (Profe de Matematica)", 
"Julieta Levis (Profe de Matematica)", "Debora Alvarez (Profe de Matematica)", 
"Cyntia de La Vega (Profe de Matematica)", "Francisco Santillan (Profe de Historia)", 
"Angie Diz (Profe de PDL)", "Mariana Fernandez (Profe de Biologia)", 
"Estefania Maffei (Profe de Biologia)", "Marcelo (Profe de Primaria Turno Mañana)", 
"Eugenia Huinchulef (Profe de Construccion de Ciudadania)", "Cintia Olsen (Profe de Taller)", 
"Carmen (Profe de Teatro y Ciudadania)", "Rocio Maldini (Profe de Fisico-Quimica)", 
"Tic (Profe de Tecnologia)", "Lucia di Gregori (Profe de Ingles 1ro)", "Pedro (Suplente Matematica)"
];

// 8. COSAS COTIDIANAS
const cosasCotidianasList = [
"Lápiz", "Goma de borrar", "Cuaderno", "Pizarrón", "Tiza", "Marcador", "Mochila", 
"Cartuchera", "Silla", "Mesa", "Computadora", "Celular", "Llaves", "Vaso", "Plato", 
"Tenedor", "Cuchillo", "Cuchara", "Botella de agua", "Zapatillas", "Remera", "Pantalón", 
"Reloj", "Anteojos", "Cama", "Almohada", "Puerta", "Ventana", "Foco", "Lámpara", 
"Libro", "Sofá", "Televisor", "Auto", "Bicicleta", "Colectivo", "Semáforo", "Árbol", 
"Pasto", "Nube", "Sol", "Luna", "Cepillo de dientes", "Ducha", "Jabón", "Shampoo"
];

// --- FIN DE NUEVAS CATEGORÍAS ---

// Listas de palabras unificadas para acceso global
const allWordLists = {
    players: playersList,
    clubs: clubsList,
    clashroyale: clashRoyaleList,
    f1Pilots: f1PilotsList,
    alumnos3ro: alumnos3roList,
    genteColegio: genteColegioList,
    profes: profesList,
    cosasCotidianas: cosasCotidianasList
};


// --- VARIABLES DE ESTADO ---
let playerCount = 3;
let impostorCount = 1;
let playerNames = ["Jugador 1", "Jugador 2", "Jugador 3"]; // Inicialmente 3
let impostorIndices = [];
let wordForPlayers = "";
let wordForImpostor = ""; // NUEVO: Para la palabra del impostor si no sabe
let currentPlayerIndex = 0;
let selectedCategory = "players";
// NUEVAS variables de estado
let enableSpecialRounds = false;
let impostorKnows = true;
let currentRoundType = "normal"; // "normal", "todosImpostores", "nadieImpostor", "todosMenosUno", "todosDistintos"

// --- REFERENCIAS DEL DOM ---
const startScreen = document.getElementById('start-screen');
const configScreen = document.getElementById('config-screen');
const wordScreen = document.getElementById('word-screen');
const endScreen = document.getElementById('end-screen');

const startGameBtn = document.getElementById('start-game-btn');
const playersMinusBtn = document.getElementById('players-minus');
const playersPlusBtn = document.getElementById('players-plus');
const impostorsMinusBtn = document.getElementById('impostors-minus');
const impostorsPlusBtn = document.getElementById('impostors-plus');
const startRoundBtn = document.getElementById('start-round-btn');
const showWordBtn = document.getElementById('show-word-btn');
const nextPlayerBtn = document.getElementById('next-player-btn');
const playAgainBtn = document.getElementById('play-again-btn');
const changeSettingsBtn = document.getElementById('change-settings-btn');
const impostorRevealBtn = document.getElementById('impostor-reveal-btn');
const toggleNamesBtn = document.getElementById('toggle-names-btn');
const playerCountEl = document.getElementById('player-count-display');
const impostorCountEl = document.getElementById('impostor-count-display');
const playerNameDisplayEl = document.getElementById('player-name-display');
const wordDisplayEl = document.getElementById('word-display');
const playerNamesContainer = document.getElementById('player-names-container');
const categorySelector = document.getElementById('category-selector');
const revealArea = document.getElementById('reveal-area');
const impostorListEl = document.getElementById('impostor-list');
const endMessageInitialEl = document.getElementById('end-message-initial');
const specialRoundInfoEl = document.getElementById('special-round-info'); // NUEVO

const messageModal = document.getElementById('message-modal');
const modalText = document.getElementById('modal-text');
const modalCloseBtn = document.getElementById('modal-close-btn');

// NUEVAS referencias del DOM
const specialRoundsCheck = document.getElementById('special-rounds-check');
const impostorKnowsCheck = document.getElementById('impostor-knows-check');
const alarmSound = document.getElementById('alarm-sound');

// --- FUNCIONES DE INTERFAZ ---
function showMessage(message) {
modalText.textContent = message;
messageModal.style.display = 'flex';
}
modalCloseBtn.addEventListener('click', () => {
messageModal.style.display = 'none';
});

function showScreen(screen) {
document.querySelectorAll('.screen').forEach(s => {
s.classList.remove('active');
});
screen.classList.add('active');
}

// NUEVO: Detener alarma (función de ayuda)
function stopAlarm() {
    document.body.classList.remove('impostor-alarm');
    alarmSound.pause();
    if (alarmSound.currentTime) {
        alarmSound.currentTime = 0;
    }
}

// --- LÓGICA DE CONFIGURACIÓN ---
function renderPlayerNameInputs() {
playerNamesContainer.innerHTML = '';
// Asegura que playerNames tenga el tamaño correcto
while (playerNames.length < playerCount) {
playerNames.push(`Jugador ${playerNames.length + 1}`);
}
playerNames = playerNames.slice(0, playerCount);

for (let i = 0; i < playerCount; i++) {
const input = document.createElement('input');
input.type = 'text';
input.classList.add('player-name-input');
input.placeholder = `Jugador ${i + 1}`;
input.value = playerNames[i];
input.dataset.index = i;
input.addEventListener('input', (e) => {
// Guarda el nombre en el array al escribir
playerNames[i] = e.target.value.trim() || `Jugador ${i + 1}`;
});
playerNamesContainer.appendChild(input);
}
playerCountEl.textContent = playerCount;
updateImpostorLimits();
}

function updateImpostorLimits() {
// No hay límite máximo de impostores, solo deben ser menos que los jugadores
if (impostorCount >= playerCount) {
impostorCount = playerCount - 1;
}
// Mínimo 1 impostor si hay jugadores (mínimo 3 jugadores)
if (playerCount > 1 && impostorCount < 1) {
impostorCount = 1;
}
impostorCountEl.textContent = impostorCount;
}

// --- LÓGICA DE ASIGNACIÓN DEL JUEGO (MUY MODIFICADA) ---
function setupGame() {
    currentPlayerIndex = 0;
    impostorIndices = [];
    wordForPlayers = "";
    wordForImpostor = "";
    currentRoundType = "normal"; // Resetea el tipo de ronda
    stopAlarm(); // Asegura que la alarma esté apagada al inicio
    
    // 1. Elegir la lista de palabras
    let wordList;
    if (selectedCategory === 'random') {
        const allLists = Object.values(allWordLists);
        wordList = allLists[Math.floor(Math.random() * allLists.length)];
    } else {
        wordList = allWordLists[selectedCategory];
    }

    // 2. Verificar Rondas Especiales
    // (Probabilidad del 25% si está habilitado)
    if (enableSpecialRounds && Math.random() < 0.25) {
        const specialType = Math.floor(Math.random() * 4);
        
        switch (specialType) {
            case 0: // Todos impostores
                currentRoundType = "Todos Impostores";
                impostorIndices = Array.from({length: playerCount}, (_, i) => i);
                wordForImpostor = "IMPOSTOR";
                wordForPlayers = "IMPOSTOR"; // Técnicamente no se usa
                break;
            case 1: // Nadie es impostor
                currentRoundType = "Nadie es Impostor";
                impostorIndices = [];
                wordForPlayers = wordList[Math.floor(Math.random() * wordList.length)];
                break;
            case 2: // Todos menos uno impostor
                currentRoundType = "Todos menos uno Impostor";
                const luckyPlayer = Math.floor(Math.random() * playerCount);
                impostorIndices = Array.from({length: playerCount}, (_, i) => i).filter(i => i !== luckyPlayer);
                wordForPlayers = wordList[Math.floor(Math.random() * wordList.length)];
                wordForImpostor = "IMPOSTOR";
                break;
            case 4: // Todos con palabra distinta
            default: // Caso de respaldo
                currentRoundType = "Todos con palabra distinta";
                impostorIndices = []; // No hay impostores, solo caos
                // La palabra se asignará en la pantalla de "mostrar palabra"
                break;
        }
    } else {
        // 3. Lógica de Ronda Normal (incluye "Impostor Sabe")
        currentRoundType = "normal";
        
        // 3a. Elegir palabra para jugadores
        const playerWordIndex = Math.floor(Math.random() * wordList.length);
        wordForPlayers = wordList[playerWordIndex];

        // 3b. Elegir palabra para impostor (si no sabe)
        if (!impostorKnows) {
            let impostorWordIndex = Math.floor(Math.random() * wordList.length);
            // Asegurarse de que sea una palabra DIFERENTE
            while (impostorWordIndex === playerWordIndex) {
                impostorWordIndex = Math.floor(Math.random() * wordList.length);
            }
            wordForImpostor = wordList[impostorWordIndex];
        } else {
            wordForImpostor = "IMPOSTOR"; // Si el impostor SÍ sabe
        }

        // 3c. Asignar los impostores
        const availablePlayerIndices = Array.from({length: playerCount}, (_, i) => i);
        while (impostorIndices.length < impostorCount) {
            const impostorIndex = availablePlayerIndices.splice(Math.floor(Math.random() * availablePlayerIndices.length), 1)[0];
            impostorIndices.push(impostorIndex);
        }
    }
}


function updateWordScreenUI() {
// Muestra SOLO el nombre del jugador actual
playerNameDisplayEl.textContent = playerNames[currentPlayerIndex];
// Restablece la pantalla para mostrar la palabra
wordDisplayEl.textContent = "";
wordDisplayEl.classList.add('hidden');
showWordBtn.classList.remove('hidden');
// Lógica para el último jugador
if (currentPlayerIndex === playerCount - 1) {
nextPlayerBtn.textContent = "Finalizar Ronda";
} else {
nextPlayerBtn.textContent = "Siguiente Jugador";
}
}
// --- EVENT LISTENERS ---

// Pantalla de inicio
startGameBtn.addEventListener('click', () => {
showScreen(configScreen);
renderPlayerNameInputs();
});
// Botón para mostrar/ocultar los campos de nombres
toggleNamesBtn.addEventListener('click', () => {
playerNamesContainer.classList.toggle('hidden');
const isHidden = playerNamesContainer.classList.contains('hidden');
toggleNamesBtn.textContent = isHidden ? "Cambiar nombres de jugadores" : "Ocultar nombres";
});

// Controles de Jugadores
playersMinusBtn.addEventListener('click', () => {
if (playerCount > 3) {
playerCount--;
renderPlayerNameInputs();
} else {
showMessage("La cantidad mínima de jugadores es 3.");
}
});
playersPlusBtn.addEventListener('click', () => {
if (playerCount < 34) { // Límite más alto para más flexibilidad
playerCount++;
renderPlayerNameInputs();
} else {
showMessage("Límite de 34 jugadores alcanzado.");
}
});
// Controles de Impostores
impostorsMinusBtn.addEventListener('click', () => {
if (impostorCount > 1) {
impostorCount--;
impostorCountEl.textContent = impostorCount;
} else {
showMessage("La cantidad mínima de impostores es 1.");
}
updateImpostorLimits();
});
impostorsPlusBtn.addEventListener('click', () => {
if (impostorCount < playerCount - 1) {
impostorCount++;
impostorCountEl.textContent = impostorCount;
} else {
showMessage(`No puede haber ${playerCount} o más impostores si solo hay ${playerCount} jugadores.`);
}
updateImpostorLimits();
});
// Selector de Categoría
categorySelector.addEventListener('change', (e) => {
selectedCategory = e.target.value;
});

// NUEVO: Listeners para los checkboxes
specialRoundsCheck.addEventListener('change', (e) => {
    enableSpecialRounds = e.target.checked;
});

impostorKnowsCheck.addEventListener('change', (e) => {
    impostorKnows = e.target.checked;
});


// Botón Iniciar Partida (Configuración)
startRoundBtn.addEventListener('click', () => {
// Validaciones
if (impostorCount > 0 && (currentRoundType === "normal" || currentRoundType === "todosMenosUno")) {
    if (playerCount <= impostorCount) {
        showMessage("La cantidad de jugadores debe ser mayor que la de impostores.");
        return;
    }
}
if (playerCount < 3) {
    showMessage("Debe haber al menos 3 jugadores.");
    return;
}

// Recoger los nombres por última vez
document.querySelectorAll('.player-name-input').forEach((input, index) => {
playerNames[index] = input.value.trim() || `Jugador ${index + 1}`;
});

setupGame();
updateWordScreenUI();
showScreen(wordScreen);
});

// Botón Mostrar Palabra (LÓGICA MUY MODIFICADA)
showWordBtn.addEventListener('click', () => {
    const isImpostor = impostorIndices.includes(currentPlayerIndex);
    
    // Resetea estilos y alarma
    wordDisplayEl.classList.remove('impostor-text');
    stopAlarm();

    // Caso 1: Ronda "Todos con palabra distinta"
    if (currentRoundType === "Todos con palabra distinta") {
        let wordList; // Obtener la lista de palabras de nuevo
        if (selectedCategory === 'random') {
            const allLists = Object.values(allWordLists);
            wordList = allLists[Math.floor(Math.random() * allLists.length)];
        } else {
            wordList = allWordLists[selectedCategory];
        }
        wordDisplayEl.textContent = wordList[Math.floor(Math.random() * wordList.length)];
    
    // Caso 2: El jugador es Impostor
    } else if (isImpostor) {
        wordDisplayEl.textContent = wordForImpostor; // "IMPOSTOR" o palabra distinta
        wordDisplayEl.classList.add('impostor-text');
        
        // ¡Activar alarma si las rondas especiales están habilitadas!
        
    // Caso 3: El jugador NO es Impostor (y no es ronda de "todos distintos")
    } else {
        wordDisplayEl.textContent = wordForPlayers;
    }

    wordDisplayEl.classList.remove('hidden');
    showWordBtn.classList.add('hidden');
});

// Botón Siguiente Jugador / Finalizar Ronda
nextPlayerBtn.addEventListener('click', () => {
    stopAlarm(); // Detener alarma al pasar al siguiente jugador
    
    if (currentPlayerIndex < playerCount - 1) {
        currentPlayerIndex++;
        updateWordScreenUI();
    } else {
        // Último jugador vio su palabra
        endMessageInitialEl.classList.remove('hidden');
        impostorRevealBtn.classList.remove('hidden');
        revealArea.classList.add('hidden');
        specialRoundInfoEl.classList.add('hidden'); // Oculta info de ronda anterior
        showScreen(endScreen);
    }
});

// Botón Revelar Impostores
impostorRevealBtn.addEventListener('click', () => {
    stopAlarm(); // Detener alarma por si acaso

    // Oculta el botón de revelación
    impostorRevealBtn.classList.add('hidden');
    endMessageInitialEl.classList.add('hidden');
    
    // Muestra el área de revelación
    revealArea.classList.remove('hidden');
    impostorListEl.innerHTML = '';

    // NUEVO: Mostrar info de ronda especial
    if (currentRoundType !== "normal") {
        let specialText = `¡Ronda Especial: ${currentRoundType}!`;
        if (currentRoundType === "Nadie es Impostor") {
            specialText += " Todos tenían la palabra.";
        } else if (currentRoundType === "Todos con palabra distinta") {
            specialText += " Cada uno vio algo diferente.";
        }
        specialRoundInfoEl.textContent = specialText;
        specialRoundInfoEl.classList.remove('hidden');
    } else {
        specialRoundInfoEl.classList.add('hidden');
    }

    // Genera la lista de nombres de impostores
    if (impostorIndices.length > 0) {
        endMessageFinal.textContent = "Los impostores eran:";
        impostorIndices.forEach(index => {
            const li = document.createElement('li');
            li.textContent = playerNames[index];
            impostorListEl.appendChild(li);
        });
    } else {
        endMessageFinal.textContent = "¡No había impostores esta ronda!";
    }
});

// Botón Jugar de Nuevo
playAgainBtn.addEventListener('click', () => {
    stopAlarm();
    setupGame(); // Nueva ronda con la misma configuración
    updateWordScreenUI();
    showScreen(wordScreen);
});

// Botón Cambiar Ajustes
changeSettingsBtn.addEventListener('click', () => {
    stopAlarm();
    renderPlayerNameInputs(); // Vuelve a cargar los inputs de nombre
    showScreen(configScreen);
});

// --- INICIALIZACIÓN ---
document.addEventListener('DOMContentLoaded', () => {
    // Cargar estado inicial de los checkboxes
    enableSpecialRounds = specialRoundsCheck.checked;
    impostorKnows = impostorKnowsCheck.checked;

    showScreen(startScreen);
    renderPlayerNameInputs(); // Inicializa los inputs de nombre
});

</script>
</body>
</html>